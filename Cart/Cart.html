<!DOCTYPE html>
<html lang="ar" dir="rtl">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
        <link rel="stylesheet" href="/Wedgit/style_header.css">
        <link rel="stylesheet" href="style.css">
        <script src="/Wedgit/script_header.js"></script>
        <title>Document</title>
    </head>
    <body>

        <header class="main-header">
            <div class="header-container">
                <a href="/Home/client_dashboard.html" class="logo-link">
                    <img src="/images/logo.png" class="logo" alt="Logo">
                </a>

                <div class="profile-menu">
                    <button class="icon-btn" id="profileBtn" type="button"
                        title="فتح القائمة">
                        <i class="fas fa-user"></i>
                    </button>

                    <ul class="dropdown" id="desktopDropdown">
                        <li><a href="#"><i class="fas fa-user-circle"></i>
                                حسابي</a></li>
                        <li><a href="#"><i class="fas fa-shopping-cart"></i>
                                سلتي</a></li>
                        <li><a href="#"><i class="fas fa-cog"></i>
                                الإعدادات</a></li>
                        <li class="divider"></li>
                        <li><a href="#"><i class="fas fa-sign-out-alt"></i>
                                خروج</a></li>
                    </ul>
                </div>
            </div>

            <div class="search-wrapper">
                <div class="search-box">
                    <input type="text" placeholder="ابحث عن منتجات...">
                    <button class="search-btn" type="submit" title="بحث"><i
                            class="fas fa-search"></i></button>
                </div>
            </div>
        </header>

        <div class="mobile-menu" id="mobileMenu">
            <a href="#">الرئيسية</a>
            <a href="#">حسابي</a>
            <a href="#">سلتي</a>
            <a href="#">الإعدادات</a>
            <a href="#">تسجيل خروج</a>
        </div>

        <div class="dashboard-container">
            <main class="main-content">
    <div class="section-header">
        <h2>سلتي</h2>
        
        <div class="header-controls">
            <button id="buyAllBtn" onclick="checkoutAll()" class="btn-buy-all" style="display: none;">
                <i class="fas fa-check-double"></i> إتمام شراء الكل
            </button>

            <select class="sort-select" title="ترتيب المنتجات">
                <option>ترتيب حسب: </option>
                <option>التاريخ: من الأحدث للاقدم</option>
                <option>التاريخ: من الاقدم للأحدث</option>
            </select>
        </div>
    </div>

    <div class="products-grid">
        </div>
</main>
        </div>
    </body>
   <script>
    function loadCart() {
        const cartItems = JSON.parse(localStorage.getItem('marketCart') || '[]');
        const container = document.querySelector('.products-grid');
        const buyAllBtn = document.getElementById('buyAllBtn'); // إمساك زر شراء الكل
        
        if (cartItems.length === 0) {
            container.innerHTML = `
                <div class="no-results">
                    <i class="fas fa-shopping-basket" style="font-size: 3rem; display: block; margin-bottom: 15px; color: #ccc;"></i>
                    السلة فارغة حالياً.. ابدأ بالتسوق الآن!
                </div>`;
            // إخفاء زر شراء الكل إذا كانت السلة فارغة
            if(buyAllBtn) buyAllBtn.style.display = 'none';
            return;
        }

        // إظهار زر شراء الكل عند وجود منتجات
        if(buyAllBtn) buyAllBtn.style.display = 'flex';

        container.innerHTML = cartItems.map((item, index) => `
            <div class="product-card">
                <div>
                    <img src="${item.img}" alt="${item.name}" class="product-image">
                    <div class="product-title">${item.name}</div>
                    <div class="product-rating">
                        <i class="fas fa-star" style="color: gold;"></i>
                        <i class="fas fa-star" style="color: gold;"></i>
                        <i class="fas fa-star" style="color: gold;"></i>
                        <i class="fas fa-star" style="color: gold;"></i>
                        <i class="fas fa-star-half-alt" style="color: gold;"></i>
                    </div>
                    <div class="product-price" style="font-size: 1.2rem; color: #b12704; font-weight: bold;">
                        ${item.price} <small>${item.currency || '$'}</small>
                    </div>
                </div>
                
                <div class="product-actions">
                    <button class="btn-buy" onclick="checkoutItem(${index})">
                        <i class="fas fa-bolt"></i> شراء
                    </button>
                    <button class="btn-delete" onclick="removeFromCart(${index})" title="حذف">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
            </div>
        `).join('');
    }

    function removeFromCart(index) {
        let cartItems = JSON.parse(localStorage.getItem('marketCart') || '[]');
        cartItems.splice(index, 1);
        localStorage.setItem('marketCart', JSON.stringify(cartItems));
        loadCart(); 
    }

    // دالة جديدة لشراء عنصر واحد (كمثال)
    function checkoutItem(index) {
        alert('تم الانتقال لصفحة الدفع لهذا المنتج!');
    }

    // دالة زر شراء الكل الجديدة
    function checkoutAll() {
        const cartItems = JSON.parse(localStorage.getItem('marketCart') || '[]');
        if (cartItems.length > 0) {
            alert(`سيتم الآن دفع قيمة ${cartItems.length} منتجات.`);
            // هنا يمكنك إضافة كود الانتقال لصفحة الدفع أو تفريغ السلة
            // localStorage.removeItem('marketCart'); // لتفريغ السلة بعد الشراء
            // loadCart();
        }
    }

    window.onload = loadCart;
</script>
</html>